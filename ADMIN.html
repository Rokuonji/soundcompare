<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Audiostudie - Admin Panel</title>
    <style>
        :root {
            --bg: #020617;
            --bg-elevated: #020617;
            --border-subtle: #1f2937;
            --accent: #4f46e5;
            --accent-soft: rgba(79, 70, 229, 0.12);
            --text-main: #e5e7eb;
            --text-muted: #9ca3af;
            --text-soft: #6b7280;
        }
        * {
            box-sizing: border-box;
        }
        body {
            margin: 0;
            padding: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: var(--bg);
            color: var(--text-main);
        }
        .page {
            max-width: 960px;
            margin: 40px auto 72px;
            padding: 0 24px;
        }
        .site-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 32px;
        }
        .site-title {
            font-size: 0.85rem;
            letter-spacing: 0.18em;
            text-transform: uppercase;
            color: var(--text-muted);
        }
        .site-title span {
            color: var(--text-main);
            font-weight: 600;
        }
        .nav-links {
            display: flex;
            gap: 0.5rem;
            font-size: 0.9rem;
        }
        .nav-link {
            padding: 0.35rem 0.8rem;
            border-radius: 999px;
            text-decoration: none;
            color: var(--text-muted);
            border: 1px solid transparent;
        }
        .nav-link:hover {
            border-color: var(--border-subtle);
            color: var(--text-main);
        }
        .nav-link-active {
            background: var(--accent-soft);
            color: var(--text-main);
            border-color: rgba(148, 163, 184, 0.5);
        }
        .card {
            background: var(--bg-elevated);
            padding: 2rem 2.2rem 2.4rem;
            border-radius: 18px;
            border: 1px solid var(--border-subtle);
            box-shadow: 0 22px 60px rgba(15, 23, 42, 0.85);
        }
        h1 {
            margin-top: 0;
            font-size: 1.7rem;
            letter-spacing: -0.03em;
        }
        .login {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        input[type="password"] {
            padding: 0.6rem 0.9rem;
            border-radius: 8px;
            border: 1px solid var(--border-subtle);
            min-width: 180px;
            background: rgba(15, 23, 42, 0.9);
            color: var(--text-main);
        }
        button {
            padding: 0.6rem 1.3rem;
            border-radius: 999px;
            border: 1px solid rgba(148, 163, 184, 0.5);
            cursor: pointer;
            background: rgba(15, 23, 42, 0.95);
            color: var(--text-main);
            font-size: 0.9rem;
        }
        button:hover {
            border-color: var(--accent);
        }
        .error {
            color: #f97373;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }
        .db-actions {
            display: flex;
            gap: 0.75rem;
            margin: 0.75rem 0 1rem;
            flex-wrap: wrap;
        }
        .db-actions button {
            background: rgba(15, 23, 42, 0.9);
        }
        textarea {
            width: 100%;
            min-height: 260px;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-size: 0.85rem;
            background: rgba(15, 23, 42, 0.9);
            color: var(--text-main);
            border-radius: 12px;
            border: 1px solid var(--border-subtle);
            padding: 0.9rem 1rem;
        }
        .hint {
            font-size: 0.85rem;
            color: var(--text-soft);
            margin-top: 0.5rem;
        }
        @media (max-width: 640px) {
            .page {
                margin: 24px auto 40px;
                padding: 0 16px;
            }
            .card {
                padding: 1.6rem 1.6rem 2rem;
            }
        }
    </style>
</head>
<body>
<div class="page">
    <header class="site-header">
        <div class="site-title"><span>Studie über Wahrnehmung komprimierter Audiodateien</span></div>
        <nav class="nav-links">
            <a href="START.html" class="nav-link">Experiment</a>
            <a href="ADMIN.html" class="nav-link nav-link-active">Admin</a>
        </nav>
    </header>

    <div class="card">
        <h1>Experiment Admin</h1>
        <p>Geben Sie den Admin Code ein, um die gespeicherten Antworten sehen zu können.</p>

        <div id="login-section">
            <div id="login-error" class="error" style="display:none"></div>
            <form id="login-form" class="login">
                <input id="admin-code" type="password" placeholder="Admin code" required />
                <button type="submit">Log in</button>
            </form>
        </div>

        <div id="data-section" style="display:none">
            <p><strong>Als Admin eingeloggt.</strong></p>
            <div class="db-actions">
                <button type="button" id="refresh-db">Datenbank aktualisieren</button>
                <button type="button" id="clear-db">Datenbank leeren</button>
                <button type="button" id="generate-test-db">5 zufällige Testdatensätze generieren</button>
            </div>
        </div>
    </div>
</div>

<script>
    // Change this to whatever admin code you want (must match ADMIN_CODE on the server)
    const ADMIN_CODE = 'admin123';

    const loginForm = document.getElementById('login-form');
    const adminCodeInput = document.getElementById('admin-code');
    const loginError = document.getElementById('login-error');
    const loginSection = document.getElementById('login-section');
    const dataSection = document.getElementById('data-section');
    const dbJsonTextarea = document.getElementById('db-json');
    const submissionCountEl = document.getElementById('submission-count');
    const refreshBtn = document.getElementById('refresh-db');
    const clearBtn = document.getElementById('clear-db');
    const generateTestBtn = document.getElementById('generate-test-db');

    async function loadDb() {
        dbJsonTextarea.value = '// Loading...';
        if (submissionCountEl) {
            submissionCountEl.textContent = '';
        }
        try {
            const res = await fetch('/api/admin-data?code=' + encodeURIComponent(ADMIN_CODE));
            if (!res.ok) {
                dbJsonTextarea.value = '// Failed to load from server: HTTP ' + res.status;
                if (submissionCountEl) {
                    submissionCountEl.textContent = 'Failed to load submission count.';
                }
                return;
            }
            const data = await res.json();
            const total = Array.isArray(data) ? data.length : 0;
            if (submissionCountEl) {
                submissionCountEl.textContent =
                    total === 1 ? '1 completed submission' : total + ' completed submissions';
            }
            if (!Array.isArray(data) || data.length === 0) {
                dbJsonTextarea.value = '// No submissions stored yet.';
                return;
            }
            dbJsonTextarea.value = JSON.stringify(data, null, 2);
        } catch (e) {
            dbJsonTextarea.value = '// Error loading from server: ' + e.message;
            if (submissionCountEl) {
                submissionCountEl.textContent = 'Error loading submission count.';
            }
        }
    }

    loginForm.addEventListener('submit', (event) => {
        event.preventDefault();
        const code = adminCodeInput.value.trim();
        if (code !== ADMIN_CODE) {
            loginError.textContent = 'Invalid admin code.';
            loginError.style.display = 'block';
            return;
        }
        loginError.style.display = 'none';
        loginSection.style.display = 'none';
        dataSection.style.display = 'block';
        loadDb();
    });

    refreshBtn.addEventListener('click', loadDb);

    clearBtn.addEventListener('click', async () => {
        if (!confirm('This will delete all stored submissions on the server. Continue?')) {
            return;
        }
        try {
            const res = await fetch('/api/admin-clear', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ code: ADMIN_CODE })
            });
            if (!res.ok) {
                alert('Failed to clear DB: HTTP ' + res.status);
                return;
            }
            await loadDb();
        } catch (e) {
            alert('Error clearing DB: ' + e.message);
        }
    });

    generateTestBtn.addEventListener('click', async () => {
        if (!confirm('This will overwrite the current database with 5 random test datasets on the server. Continue?')) {
            return;
        }
        try {
            const res = await fetch('/api/admin-generate-test', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ code: ADMIN_CODE, count: 5 })
            });
            if (!res.ok) {
                alert('Failed to generate test data: HTTP ' + res.status);
                return;
            }
            await loadDb();
        } catch (e) {
            alert('Error generating test data: ' + e.message);
        }
    });
</script>
</body>
</html>


